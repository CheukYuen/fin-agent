---
alwaysApply: true
---

# Python 3.11 åˆå­¦è€…å¼€å‘è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒåŸåˆ™
- **ç®€å•ä¼˜å…ˆ**: å…ˆè®©ä»£ç è·‘èµ·æ¥ï¼Œå†ä¼˜åŒ–
- **ç±»å‹å®‰å…¨**: æ‰€æœ‰å‡½æ•°éƒ½è¦æœ‰ç±»å‹æ³¨è§£
- **é”™è¯¯å¤„ç†**: æ¯ä¸ª API éƒ½è¦å¤„ç†å¯èƒ½çš„é”™è¯¯
- **æ–‡æ¡£æ¸…æ™°**: ä»£ç å³æ–‡æ¡£ï¼Œæ³¨é‡Šè¦ç®€æ´æ˜äº†

## ğŸ“ é¡¹ç›®ç»“æ„ (å¿…é¡»æŒæ¡)
```
app/
â”œâ”€â”€ main.py          # ç¨‹åºå…¥å£
â”œâ”€â”€ api_router.py    # API è·¯ç”±
â”œâ”€â”€ config.py        # é…ç½®ç®¡ç†
â”œâ”€â”€ models/
â”‚   â””â”€â”€ schema.py    # æ•°æ®æ¨¡å‹ (Pydantic)
â””â”€â”€ services/
    â”œâ”€â”€ llm_service.py    # AI æœåŠ¡
    â””â”€â”€ redis_service.py  # æ•°æ®å­˜å‚¨
```

## ğŸ Python åŸºç¡€è§„èŒƒ

### 1. ç±»å‹æ³¨è§£ (å¿…é¡»)
```python
# âœ… æ­£ç¡®
def get_user(user_id: int) -> dict[str, str]:
    return {"id": str(user_id), "name": "å¼ ä¸‰"}

# âŒ é”™è¯¯
def get_user(user_id):
    return {"id": user_id, "name": "å¼ ä¸‰"}
```

### 2. å¼‚æ­¥å‡½æ•° (FastAPI å¿…é¡»)
```python
# âœ… æ­£ç¡®
async def chat_endpoint(request: ChatRequest) -> ChatResponse:
    result = await process_message(request.message)
    return ChatResponse(message=result)

# âŒ é”™è¯¯
def chat_endpoint(request: ChatRequest) -> ChatResponse:
    result = process_message(request.message)  # æ²¡æœ‰ await
    return ChatResponse(message=result)
```

### 3. é”™è¯¯å¤„ç† (å¿…é¡»)
```python
# âœ… æ­£ç¡®
async def get_user(user_id: int) -> dict[str, str]:
    if user_id <= 0:
        raise HTTPException(status_code=400, detail="ç”¨æˆ·IDå¿…é¡»å¤§äº0")
    return {"id": str(user_id), "name": "å¼ ä¸‰"}

# âŒ é”™è¯¯
async def get_user(user_id: int) -> dict[str, str]:
    return {"id": str(user_id), "name": "å¼ ä¸‰"}  # æ²¡æœ‰éªŒè¯
```

## ğŸ“‹ Pydantic æ¨¡å‹ (æ ¸å¿ƒ)

### åŸºæœ¬æ¨¡å‹
```python
from pydantic import BaseModel, Field

class ChatRequest(BaseModel):
    session_id: str = Field(..., description="ä¼šè¯ID")
    message: str = Field(..., description="ç”¨æˆ·æ¶ˆæ¯", min_length=1)
    temperature: float = Field(default=0.7, description="ç”Ÿæˆæ¸©åº¦")
```

### å“åº”æ¨¡å‹
```python
class ChatResponse(BaseModel):
    message: str = Field(..., description="AI å›å¤")
    session_id: str = Field(..., description="ä¼šè¯ID")
```

## ğŸ”§ å¼€å‘æµç¨‹ (æŒ‰é¡ºåº)

### 1. å†™æ¨¡å‹ (schema.py)
```python
# å…ˆå®šä¹‰æ•°æ®ç»“æ„
class YourRequest(BaseModel):
    field1: str = Field(..., description="å­—æ®µ1")
    field2: int = Field(default=0, description="å­—æ®µ2")
```

### 2. å†™æœåŠ¡ (services/)
```python
# å†å†™ä¸šåŠ¡é€»è¾‘
async def your_service(data: YourRequest) -> str:
    # å¤„ç†é€»è¾‘
    return "å¤„ç†ç»“æœ"
```

### 3. å†™è·¯ç”± (api_router.py)
```python
# æœ€åå†™ API æ¥å£
@router.post("/your-endpoint")
async def your_endpoint(request: YourRequest) -> dict[str, str]:
    result = await your_service(request)
    return {"result": result}
```

### 4. æµ‹è¯• (å¿…é¡»)
```python
# æµ‹è¯•ä½ çš„ API
def test_your_endpoint():
    response = client.post("/your-endpoint", json={"field1": "test"})
    assert response.status_code == 200
```

## âš ï¸ å¸¸è§é”™è¯¯ (é¿å…)

### 1. å¿˜è®°ç±»å‹æ³¨è§£
```python
# âŒ é”™è¯¯
def process_data(data):
    return data.upper()

# âœ… æ­£ç¡®
def process_data(data: str) -> str:
    return data.upper()
```

### 2. å¿˜è®°å¼‚æ­¥
```python
# âŒ é”™è¯¯
def chat_endpoint(request: ChatRequest):
    return {"message": "hello"}

# âœ… æ­£ç¡®
async def chat_endpoint(request: ChatRequest):
    return {"message": "hello"}
```

### 3. å¿˜è®°é”™è¯¯å¤„ç†
```python
# âŒ é”™è¯¯
async def get_user(user_id: int):
    user = database.get_user(user_id)  # å¯èƒ½å¤±è´¥
    return user

# âœ… æ­£ç¡®
async def get_user(user_id: int):
    try:
        user = await database.get_user(user_id)
        if not user:
            raise HTTPException(status_code=404, detail="ç”¨æˆ·ä¸å­˜åœ¨")
        return user
    except Exception as e:
        raise HTTPException(status_code=500, detail="æœåŠ¡å™¨é”™è¯¯")
```

## ğŸš€ å¿«é€Ÿå¼€å§‹
1. `source .venv/bin/activate`  # æ¿€æ´»ç¯å¢ƒ
2. `pip install -r requirements.txt`  # å®‰è£…ä¾èµ–
3. `uvicorn app.main:app --reload`  # å¯åŠ¨æœåŠ¡
4. è®¿é—® `http://localhost:8000/docs`  # æŸ¥çœ‹æ–‡æ¡£

## ğŸ’¡ å­¦ä¹ å»ºè®®
- **å…ˆæ¨¡ä»¿**: å¤åˆ¶ç°æœ‰ä»£ç ï¼Œç†è§£ç»“æ„
- **å†ä¿®æ”¹**: å°æ­¥ä¿®æ”¹ï¼Œæµ‹è¯•éªŒè¯
- **ååˆ›æ–°**: æŒæ¡åŸºç¡€åï¼Œå°è¯•æ–°åŠŸèƒ½
- **å¤šæµ‹è¯•**: æ¯å†™ä¸€ä¸ªåŠŸèƒ½ï¼Œéƒ½è¦æµ‹è¯•

# Python 3.11 åˆå­¦è€…å¼€å‘è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒåŸåˆ™
- **ç®€å•ä¼˜å…ˆ**: å…ˆè®©ä»£ç è·‘èµ·æ¥ï¼Œå†ä¼˜åŒ–
- **ç±»å‹å®‰å…¨**: æ‰€æœ‰å‡½æ•°éƒ½è¦æœ‰ç±»å‹æ³¨è§£
- **é”™è¯¯å¤„ç†**: æ¯ä¸ª API éƒ½è¦å¤„ç†å¯èƒ½çš„é”™è¯¯
- **æ–‡æ¡£æ¸…æ™°**: ä»£ç å³æ–‡æ¡£ï¼Œæ³¨é‡Šè¦ç®€æ´æ˜äº†

## ğŸ“ é¡¹ç›®ç»“æ„ (å¿…é¡»æŒæ¡)
```
app/
â”œâ”€â”€ main.py          # ç¨‹åºå…¥å£
â”œâ”€â”€ api_router.py    # API è·¯ç”±
â”œâ”€â”€ config.py        # é…ç½®ç®¡ç†
â”œâ”€â”€ models/
â”‚   â””â”€â”€ schema.py    # æ•°æ®æ¨¡å‹ (Pydantic)
â””â”€â”€ services/
    â”œâ”€â”€ llm_service.py    # AI æœåŠ¡
    â””â”€â”€ redis_service.py  # æ•°æ®å­˜å‚¨
```

## ğŸ Python åŸºç¡€è§„èŒƒ

### 1. ç±»å‹æ³¨è§£ (å¿…é¡»)
```python
# âœ… æ­£ç¡®
def get_user(user_id: int) -> dict[str, str]:
    return {"id": str(user_id), "name": "å¼ ä¸‰"}

# âŒ é”™è¯¯
def get_user(user_id):
    return {"id": user_id, "name": "å¼ ä¸‰"}
```

### 2. å¼‚æ­¥å‡½æ•° (FastAPI å¿…é¡»)
```python
# âœ… æ­£ç¡®
async def chat_endpoint(request: ChatRequest) -> ChatResponse:
    result = await process_message(request.message)
    return ChatResponse(message=result)

# âŒ é”™è¯¯
def chat_endpoint(request: ChatRequest) -> ChatResponse:
    result = process_message(request.message)  # æ²¡æœ‰ await
    return ChatResponse(message=result)
```

### 3. é”™è¯¯å¤„ç† (å¿…é¡»)
```python
# âœ… æ­£ç¡®
async def get_user(user_id: int) -> dict[str, str]:
    if user_id <= 0:
        raise HTTPException(status_code=400, detail="ç”¨æˆ·IDå¿…é¡»å¤§äº0")
    return {"id": str(user_id), "name": "å¼ ä¸‰"}

# âŒ é”™è¯¯
async def get_user(user_id: int) -> dict[str, str]:
    return {"id": str(user_id), "name": "å¼ ä¸‰"}  # æ²¡æœ‰éªŒè¯
```

## ğŸ“‹ Pydantic æ¨¡å‹ (æ ¸å¿ƒ)

### åŸºæœ¬æ¨¡å‹
```python
from pydantic import BaseModel, Field

class ChatRequest(BaseModel):
    session_id: str = Field(..., description="ä¼šè¯ID")
    message: str = Field(..., description="ç”¨æˆ·æ¶ˆæ¯", min_length=1)
    temperature: float = Field(default=0.7, description="ç”Ÿæˆæ¸©åº¦")
```

### å“åº”æ¨¡å‹
```python
class ChatResponse(BaseModel):
    message: str = Field(..., description="AI å›å¤")
    session_id: str = Field(..., description="ä¼šè¯ID")
```

## ğŸ”§ å¼€å‘æµç¨‹ (æŒ‰é¡ºåº)

### 1. å†™æ¨¡å‹ (schema.py)
```python
# å…ˆå®šä¹‰æ•°æ®ç»“æ„
class YourRequest(BaseModel):
    field1: str = Field(..., description="å­—æ®µ1")
    field2: int = Field(default=0, description="å­—æ®µ2")
```

### 2. å†™æœåŠ¡ (services/)
```python
# å†å†™ä¸šåŠ¡é€»è¾‘
async def your_service(data: YourRequest) -> str:
    # å¤„ç†é€»è¾‘
    return "å¤„ç†ç»“æœ"
```

### 3. å†™è·¯ç”± (api_router.py)
```python
# æœ€åå†™ API æ¥å£
@router.post("/your-endpoint")
async def your_endpoint(request: YourRequest) -> dict[str, str]:
    result = await your_service(request)
    return {"result": result}
```

### 4. æµ‹è¯• (å¿…é¡»)
```python
# æµ‹è¯•ä½ çš„ API
def test_your_endpoint():
    response = client.post("/your-endpoint", json={"field1": "test"})
    assert response.status_code == 200
```

## âš ï¸ å¸¸è§é”™è¯¯ (é¿å…)

### 1. å¿˜è®°ç±»å‹æ³¨è§£
```python
# âŒ é”™è¯¯
def process_data(data):
    return data.upper()

# âœ… æ­£ç¡®
def process_data(data: str) -> str:
    return data.upper()
```

### 2. å¿˜è®°å¼‚æ­¥
```python
# âŒ é”™è¯¯
def chat_endpoint(request: ChatRequest):
    return {"message": "hello"}

# âœ… æ­£ç¡®
async def chat_endpoint(request: ChatRequest):
    return {"message": "hello"}
```

### 3. å¿˜è®°é”™è¯¯å¤„ç†
```python
# âŒ é”™è¯¯
async def get_user(user_id: int):
    user = database.get_user(user_id)  # å¯èƒ½å¤±è´¥
    return user

# âœ… æ­£ç¡®
async def get_user(user_id: int):
    try:
        user = await database.get_user(user_id)
        if not user:
            raise HTTPException(status_code=404, detail="ç”¨æˆ·ä¸å­˜åœ¨")
        return user
    except Exception as e:
        raise HTTPException(status_code=500, detail="æœåŠ¡å™¨é”™è¯¯")
```

## ğŸš€ å¿«é€Ÿå¼€å§‹
1. `source .venv/bin/activate`  # æ¿€æ´»ç¯å¢ƒ
2. `pip install -r requirements.txt`  # å®‰è£…ä¾èµ–
3. `uvicorn app.main:app --reload`  # å¯åŠ¨æœåŠ¡
4. è®¿é—® `http://localhost:8000/docs`  # æŸ¥çœ‹æ–‡æ¡£

## ğŸ’¡ å­¦ä¹ å»ºè®®
- **å…ˆæ¨¡ä»¿**: å¤åˆ¶ç°æœ‰ä»£ç ï¼Œç†è§£ç»“æ„
- **å†ä¿®æ”¹**: å°æ­¥ä¿®æ”¹ï¼Œæµ‹è¯•éªŒè¯
- **ååˆ›æ–°**: æŒæ¡åŸºç¡€åï¼Œå°è¯•æ–°åŠŸèƒ½
- **å¤šæµ‹è¯•**: æ¯å†™ä¸€ä¸ªåŠŸèƒ½ï¼Œéƒ½è¦æµ‹è¯•

